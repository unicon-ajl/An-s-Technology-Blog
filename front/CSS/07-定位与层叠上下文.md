
# 定位与层叠上下文

> 🛠️ **掌握布局的核心在于理解元素如何被放置在页面上，以及它们之间的相互关系**。  
> CSS 提供了多种定位机制来精确控制元素的位置，并通过层叠上下文（Stacking Context）管理这些元素的显示顺序。

---

## 元素定位基础

### 静态定位（Static Positioning）

默认情况下，所有 HTML 元素都使用静态定位，这意味着它们按照文档流自然排列，无法通过 `top`, `bottom`, `left`, 或 `right` 属性进行调整。
```css
div {
    position: static; /* 默认值 */
}
```

### 相对定位（Relative Positioning）

相对定位允许一个元素相对于其正常位置进行偏移，但该元素仍然占据文档流中的空间。
```css
div {
    position: relative;
    top: 10px; /* 向下移动 10 像素 */
    left: 20px; /* 向右移动 20 像素 */
}
```

### 绝对定位（Absolute Positioning）

绝对定位会将元素从文档流中移除，并依据最近的非静态定位祖先元素进行定位。如果没有这样的祖先，则依据初始包含块（通常是视口）定位。
```css
div {
    position: absolute;
    top: 50px; /* 距离顶部 50 像素 */
    right: 30px; /* 距离右侧 30 像素 */
}
```

### 固定定位（Fixed Positioning）

固定定位类似于绝对定位，但它总是相对于浏览器窗口定位，即使页面滚动时也保持不变。
```css
div {
    position: fixed;
    bottom: 0; /* 紧贴底部 */
    left: 0; /* 紧贴左侧 */
}
```

### 粘性定位（Sticky Positioning）

粘性定位是一种相对新的定位方式，它结合了相对定位和固定定位的行为。当元素达到特定阈值（如滚动到某个位置）时，它会变为固定定位。
```css
div {
    position: sticky;
    top: 20px; /* 当滚动到距离顶部 20 像素时变为固定 */
}
```

---

## 层叠上下文（Stacking Context）

层叠上下文是决定元素在 Z 轴方向堆叠顺序的三维概念。每个元素根据其创建的层叠上下文和其他属性（如 `z-index`）确定其显示顺序。

### 创建层叠上下文的方式

- 根元素 (`html`)
- `position` 值为 `absolute` 或 `relative` 并且 `z-index` 不为 `auto`
- `position` 值为 `fixed` 或 `sticky`
- 使用透明度 (`opacity`) 小于 1 的元素
- 应用了某些 CSS 滤镜的元素
- 及其他特定情况

### z-index 属性

`z-index` 决定了处于同一层叠上下文中元素的前后顺序。具有较高 `z-index` 的元素会在较低 `z-index` 的元素之前绘制。
```css
.element {
    position: relative;
    z-index: 10; /* 设置较高的堆叠层级 */
}
```

注意：`z-index` 仅在元素的 `position` 属性不是 `static` 时生效。

---

## 实际应用技巧

### 利用定位实现复杂布局

通过组合不同的定位方式，可以构建出复杂的布局结构。例如，使用绝对定位可以在父容器内精确定位子元素，而不会影响页面其他部分的布局。

### 解决重叠问题

当元素发生重叠时，可以通过调整 `z-index` 来解决显示顺序的问题。确保合理设置 `z-index` 值，以避免意外的层叠效果。

### 测试与调试

利用浏览器开发者工具检查元素的层叠顺序及定位情况，有助于快速发现并解决问题。

---

✅ 本篇重点讲述了 CSS 中用于控制元素位置的各种定位方法，以及如何通过层叠上下文管理元素的堆叠顺序。这对于构建灵活、响应式的网页布局至关重要。